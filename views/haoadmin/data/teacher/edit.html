<style type="text/css">
  legend{border-bottom: 0px;}
</style>
<script type="text/javascript" src="/static/js/jquery.uploadify.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.uploadify.js"></script>
<script type="text/javascript" src="/static/js/jquery.easyui.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    $('#Image').uploadify({
      'swf'      : '/static/img/uploadify.swf',// uploadify.swf 文件的相对JS文件的路径
      'uploader' : '/weserver/data/upload',//后台处理程序的相对路径
      'floder': '/upload/teacher',          
      'fileSizeLimit': '2MB',
      'queueID': 'fileQueue',
      'queueSizeLimit': 999999999,
      'uploadLimit': 999999999,
      //'progressData': 'speed',
      'auto': true,
      'multi': false,
      'buttonClass' : 'some-class',//自定义的样式类名
      //'queueID'  : 'some_file_queue',
      //'buttonCursor' : 'arrow',
      //'buttonText': '上传图片',
      'buttonTitle': '提示文字',
      'buttonImage':'/static/images/i/img/upload_file.png',
      'requeueErrors' : true,
      'debug': false,
       'height'   : 28, // The height of the flash button
      'width'    : 155, // The width of the flash button
      'itemTemplate':false,
      'successTimeout': 30,//设置文件上传后等待服务器响应的秒数，超出这个时间，将会被认为上传成功，默认为30秒
      'fileTypeExts': '*.bmp;*.jpg;.jpeg;*.png;*.gif',//设置允许上传的文件扩展名（也就是文件类型）。但手动键入文件名可以绕过这种级别的安全检查，所以你应该始终在服务端中检查文件类型。输入多个扩展名时用分号隔开('*.*;*.jpg;*.png;*.gif')
      'fileTypeDesc': '文件格式',//可选文件的描述。这个值出现在文件浏览窗口中的文件类型下拉选项中。（但我设置了好像没效果？原文：The description of the selectable files.  This string appears in the browse files dialog box in the file type drop down.）
      'fileObjName':'Filedata', //设置后台的文件名
      'method'   : 'post',
      'onUploadSuccess': function(file,data,response){
        if(data!=null){
          data = jQuery.parseJSON(data);
          if(data.status){
            $("input[name=Icon]").val(data.url);
            $("#preview").attr("src",data.url);
          }
        }
      },
      'onSelectError':function(file,data,response){
        if(data!=null){
          data = jQuery.parseJSON(data);
          if(data.status){
            var str = data.url;
            switch(errorCode) {
                case -110:
                    alert("文件 ["+str+"] 大小超出系统限制的" + jQuery('#Img').uploadify('settings', 'fileSizeLimit') + "大小！");
                    break;
                case -120:
                    alert("文件 ["+str+"] 大小异常！");
                    break;
                case -130:
                    alert("文件 ["+str+"] 类型不正确！");
                    break;
            }
          }
        }
      },
    });
  });
</script>
<div class="crumb-wrap">
    <div class="crumb-list"><i class="icon-font"></i><a href="/public/index">首页</a><span class="crumb-step">&gt;</span><span class="crumb-name"><a href="/weserver/data/teacher_index">讲师管理</a></span><span class="crumb-step">&gt;</span><span class="crumb-name">添加讲师</span></div>
</div>
<div class="am-g">
  <div class="am-u-lg-6">
    <form action="teacher_edit" id="teacherform" class="am-form" method="post" enctype="multipart/form-data"  data-am-validator>
      <fieldset>
        <legend></legend>
        <input type="hidden" value="{{.teacher.Id}}" name="id">
        <input type="hidden" value="edit" name="action">

              <div class="am-form-group">
          <label for="doc-select-1">请选择公司:</label>
          <select id="doc-select-company" name="Company"  required data-validation-message="请选择房间" onchange="getRoomInfo()">
            <option value="">-=请选择公司=-</option>
            {{range $index,$ele := .companyInfo}}
            <option value="{{$ele.Id}}">{{$ele.Company}}</option>
            {{end}}
          </select>
          <span class="am-form-caret"></span>
        </div>

     <!--   <div class="am-form-group">
          <label for="doc-select-1">请选择房间:</label>
          <select id="doc-select-room" name="Room"  required data-validation-message="请选择房间">
            <option value="">-=请选择房间=-</option>
            {{range $index,$ele := .roonInfo}}
            <option value="{{$ele.RoomId}}">{{$ele.RoomTitle}}</option>
            {{end}}
          </select>
          <span class="am-form-caret"></span>
        </div> -->
                             <div class="am-form-group">
                              <label for="doc-select-1">请选择房间:</label> 
                            <select id="doc-select-room" name="Room" required data-validation-message="请选择房间">
                                <option value="">-=请选择房间=-</option>
                                <!--{{range $index ,$ele := .roonInfo}}
                                <option value="{{$ele.RoomId}}">{{$ele.RoomTitle}}</option>
                                {{end}}-->
                            </select>
                        </div>
     

        <div class="am-form-group">
          <label for="doc-vld-Title-2">讲师名称：</label>
          <input type="text" name="Name" value="{{.teacher.Name}}" id="doc-vld-Title-2" placeholder="输入讲师名称" data-validation-message="请输入讲师名称" required/>
           <input type="hidden" name="fname" />
        </div>
        <div class="am-form-group">
          <label for="doc-vld-Title-2">讲师图片：</label>
            <input type="file" name="Image" id="Image" multiple="true" /> 
            <input type="hidden" name="Icon" id="Icon" value="{{.teacher.Icon}}" multiple="true" /> 
        </div>

        <div class="am-form-group" >
            <img id="preview" src="{{.teacher.Icon}}" style="width:200px;height: 200px;border: 0px;soild:#FFFFFF; " />
        </div>

         <div class="am-form-group">
          <label for="doc-vld-ta-2">讲师简介：</label>
          <textarea id="doc-vld-ta-2" name="Data" placeholder="输入讲师简介" data-validation-message="请输入讲师简介" required>{{.teacher.Data}}</textarea>
        </div>

        <button class="am-btn am-btn-secondary" type="submit">提交</button>
      </fieldset>
    </form>
  </div>
</div>

<script type="text/javascript">
$(function() {
    
  $("#doc-select-company").find("option[value='{{.teacher.CompanyId}}']").attr("selected",true);
  getRoomInfo();
 
});

    function getCompanyInfo() {
      $.ajax({
        url: '/weserver/common/getCompanyInfo',
        type: 'POST',
        success: function(data){
            console.log(data, 'data');
            var company = ["<option value=''>-=所属公司=-</option>"];
            for (var i = 0; i<data.CompanyList.length;i++){
                company.push("<option value="+data.CompanyList[i].Id+">-="+data.CompanyList[i].Company+"=-</option>");
            }
            $('#doc-select-company').html(company.join(''));
        }
      })
    }

    	function getRoomInfo() {
      var companyId = document.getElementById("doc-select-company").value;
      $.ajax({
        url: '/weserver/common/getRoomInfo',
        type: 'POST',
        data: {
          CompanyId: parseInt(companyId, 10),
        },
        success: function(data){
            var room = ["<option value=''>-=所属房间=-</option>"];
            for (var i = 0; i<data.roonInfo.length;i++){
                room.push("<option value="+data.roonInfo[i].RoomId+">-="+data.roonInfo[i].Title+"=-</option>");
            }
            $('#doc-select-room').html(room.join(''));
            $("#doc-select-room").find("option[value='{{.teacher.Room}}']").attr("selected",true);
        }
      })
    }
</script>


