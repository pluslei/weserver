<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="_xsrf" content="{{.xsrf_token}}" />
        <link href="/static/css/login.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" type="text/css" href="/static/css/amazeui.css"/>
        <script type="text/javascript" src="/static/js/jquery.min.js"></script>
        <script type="text/javascript" src="/static/js/jquery.easyui.min.js"></script>
        <script type="text/javascript" src="/static/js/jquery.uploadify.min.js"></script>
        <script type="text/javascript" src="/static/js/jquery.uploadify.js"></script>
        <script type="text/javascript" src="/static/js/jquery.easyui.min.js"></script>
        <script type="text/javascript">
        $(document).ready(function () {
            $('#FileName').uploadify({
                'swf'      : '/static/img/uploadify.swf',// uploadify.swf 文件的相对JS文件的路径
                'uploader' : '/weserver/data/upload',//后台处理程序的相对路径
                'floder': '/upload/teachbanner',          
                'fileSizeLimit': '120KB',
                'queueID': 'fileQueue',
                'queueSizeLimit': 999999999,
                'uploadLimit': 999999999,
                //'progressData': 'speed',
                'auto': true,
                'multi': false,
                'buttonClass' : 'some-class',//自定义的样式类名
                //'queueID'  : 'some_file_queue',
                //'buttonCursor' : 'arrow',
                //'buttonText': '上传图片',
                'buttonTitle': '提示文字',
                'buttonImage':'/static/images/i/img/upload_file.png',
                'requeueErrors' : true,
                'debug': false,
                'height'   : 28, // The height of the flash button
                'width'    : 155, // The width of the flash button
                'itemTemplate':false,
                'successTimeout': 30,//设置文件上传后等待服务器响应的秒数，超出这个时间，将会被认为上传成功，默认为30秒
                'fileTypeExts': '*.bmp;*.jpg;.jpeg;*.png;*.gif',//设置允许上传的文件扩展名（也就是文件类型）。但手动键入文件名可以绕过这种级别的安全检查，所以你应该始终在服务端中检查文件类型。输入多个扩展名时用分号隔开('*.*;*.jpg;*.png;*.gif')
                'fileTypeDesc': '文件格式',//可选文件的描述。这个值出现在文件浏览窗口中的文件类型下拉选项中。（但我设置了好像没效果？原文：The description of the selectable files.  This string appears in the browse files dialog box in the file type drop down.）
                'fileObjName':'Filedata', //设置后台的文件名
                'method'   : 'post',
                'formData': {"uploadtype":"roomico"},
                'onUploadSuccess': function(file,data,response){
                if(data!=null){
                    data = jQuery.parseJSON(data);
                    if(data.status){
                    $("input[name=FileNameFile]").val(data.url);
                    $("#preview").attr("src",data.url);
                    }
                }
                },
                'onSelectError':function(file,data,response){
                if(data!=null){
                    data = jQuery.parseJSON(data);
                    if(data.status){
                    var str = data.url;
                    switch(errorCode) {
                        case -110:
                            alert("文件 ["+str+"] 大小超出系统限制的" + jQuery('#Img').uploadify('settings', 'fileSizeLimit') + "大小！");
                            break;
                        case -120:
                            alert("文件 ["+str+"] 大小异常！");
                            break;
                        case -130:
                            alert("文件 ["+str+"] 类型不正确！");
                            break;
                    }
                    }
                }
                },
            });
        });
        </script>
        <script type="text/javascript">
            function sendbroad() {
                content = $("#remarkcontent").val();
                // weserver/data/sendbroadhandle
                $.ajax({
                    url: '/weserver/data/sendbroadhandle',
                    type: 'POST',
                    data: {content: content},
                    success: function(rsp){
                        if (rsp.status){
                            alert(rsp.info);
                        }else{
                            alert(rsp.info);
                        }
                    }
                })
            }
        </script>
        <script type="text/javascript" src="/static/lib/layer/layer.min.js"></script>
    </head>
    <body>
        <div class="am-form">
          <fieldset>
            <div class="am-form-group">
              <label for="doc-ta-1">发送广播</label>
              <textarea class="" rows="5" name="remarkcontent" id="remarkcontent" placeholder="请输入内容..."></textarea>
            </div>
            <div class="am-form-group">
                <label for="doc-vld-Title-2">广播图片(请上传jpg,png文件)：</label>
                <input type="file" name="FileName" id="FileName" multiple="true" />
                <input type="hidden" name="FileNameFile" id="FileNameFile" multiple="true" /> 
            </div>
            <div class="am-form-group" >
                <img id="preview" src="" style="width:375px;height:100px;border: 0px;soild:#FFFFFF; " />
            </div>

            <p><button type="submit" class="am-btn am-btn-default" onclick="sendbroad()">提交</button></p>
          </fieldset>
        </div>
    </body>
</html>

